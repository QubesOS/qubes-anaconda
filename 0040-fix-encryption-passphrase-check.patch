From 38a6605aaf5258d099c9ae38fc207ad0d5298488 Mon Sep 17 00:00:00 2001
From: Wojtek Porczyk <woju@invisiblethingslab.com>
Date: Fri, 19 Oct 2018 08:02:13 +0200
Subject: [PATCH] fix encryption passphrase check

The installer checks if there is password for autopart. It should check
that only if autopart is actually in use.

QubesOS/qubes-issues#2180
---
 pyanaconda/ui/gui/spokes/storage.py | 1 +
 1 file changed, 1 insertion(+)

diff --git a/pyanaconda/ui/gui/spokes/storage.py b/pyanaconda/ui/gui/spokes/storage.py
index b57c44d9f..fb10498f6 100644
--- a/pyanaconda/ui/gui/spokes/storage.py
+++ b/pyanaconda/ui/gui/spokes/storage.py
@@ -473,6 +473,7 @@ class StorageSpoke(NormalSpoke, StorageCheckHandler):
         hubQ.send_message(self.__class__.__name__, _("Saving storage configuration..."))
         threadMgr.wait(constants.THREAD_STORAGE)
         if flags.automatedInstall \
+                and self._auto_part_observer.proxy.Enabled \
                 and self._auto_part_observer.proxy.Encrypted \
                 and not self._auto_part_observer.proxy.Passphrase:
             self.autopart_missing_passphrase = True
-- 
2.20.1

